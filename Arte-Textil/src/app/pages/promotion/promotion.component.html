<div class="promotions-wrapper">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">Promociones</h2>

        <button class="btn btn-primary" (click)="openCreateModal()">
            Crear promoción <i class="mdi mdi-plus"></i>
        </button>
    </div>

    <p class="text-muted">Administración completa de promociones.</p>

    <!-- TABLA PRINCIPAL -->
    <div class="table-responsive card shadow-sm p-3">

        <table class="table align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Promoción</th>
                    <th>Producto</th>
                    <th>Descuento</th>
                    <th>Vigencia</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>

            <tbody>
                @for (p of promotions; track p.promotionId) {
                <tr>

                    <td>{{ p.name }}</td>
                    <td>{{ p.productName || getProductName(p.productId) }}</td>
                    <td>{{ p.discountPercent }}%</td>
                    <td>{{ (p.startDate | date:'dd/MM/yyyy') || 'N/A' }} → {{ (p.endDate | date:'dd/MM/yyyy') || 'N/A' }}</td>

                    <td>
                        <span class="badge state cursor-pointer" [class.bg-success]="p.isActive"
                            [class.bg-secondary]="!p.isActive" (click)="onChangeStatus(p)">
                            {{ p.isActive ? 'Activa' : 'Inactiva' }}
                        </span>
                    </td>

                    <td class="text-end">

                        <button class="btn btn-primary btn-sm me-1" (click)="openEditModal(p)">
                            Editar
                        </button>

                        <button class="btn btn-sm btn-light" (click)="openDeleteModal(p)">
                            @if (p.isActive) {
                                <i class="mdi mdi-eye-off"></i>
                            }@else {
                                <i class="mdi mdi-eye-outline"></i>
                            }
                        </button>

                    </td>

                </tr>
                }
            </tbody>

        </table>

    </div>

    <!-- Modales -->
    @if (showFormModal) {
    <app-promotion-form-modal [promotion]="editingPromotion" [products]="products"
        (saveCreate)="saveCreatedPromotion($event)" (saveUpdate)="saveUpdatedPromotion($event)"
        (close)="showFormModal = false">
    </app-promotion-form-modal>
    }
    
    @if (showDeleteModal) {
    <app-promotion-delete-modal [promotion]="deletePromotion" (confirm)="deletePromotionLogic()"
        (close)="showDeleteModal = false">
    </app-promotion-delete-modal>
    }

</div>