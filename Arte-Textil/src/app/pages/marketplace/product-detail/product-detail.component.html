<div class="product-detail-wrapper container">

    <div class="mb-3" (click)="onBackToMarketplace()">
        <a routerLink="/marketplace" class="btn btn-outline-secondary d-inline-flex align-items-center">
            <i class="mdi mdi-arrow-left me-2" aria-hidden="true"></i>
            Volver al marketplace
        </a>
    </div>

    @if(product.productId > 0) {
    <div class="row g-4">

        <!-- GALERÍA DE IMÁGENES -->
        <div class="col-lg-6">

            <!-- Imagen Principal -->
            <div class="image-main shadow-sm">
                <img [src]="selectedImage" class="img-fluid rounded">
            </div>

            <!-- Miniaturas -->
            <div class="thumbs d-flex gap-2 mt-3">

                @for (img of product.productImages; track img) {
                <img [src]="img.imageUrl" class="thumb-img rounded" [class.active]="img.imageUrl === selectedImage"
                    (click)="changeImage(img.imageUrl)">
                }
            </div>

        </div>

        <!-- INFORMACIÓN DEL PRODUCTO -->
        <div class="col-lg-6">

            <h2 class="fw-bold">{{ product.name }}</h2>

            @if(product.categoryName) {
            <p class="text-muted mb-2">
                Categoría: <strong>{{ product.categoryName }}</strong>
            </p>
            }

            @if(product.supplierName) {
            <p class="text-muted mb-2">
                Proveedor: <strong>{{ product.supplierName }}</strong>
            </p>
            }

            <!-- Precio -->
            <h3 class="text-primary fw-bold">
                {{ product.price | customCurrency:'₡' }}
            </h3>

            <!-- Promoción -->
            @if (product.bestPromotion) {
            <span class="badge bg-warning text-dark">
                -{{ product.bestPromotion.discountPercent }}% hasta {{ product.bestPromotion.endDate |
                date:'dd/MM/yyyy'}}
            </span>
            }

            <p class="mt-3">{{ product.description }}</p>

            <!-- Estado de stock -->
            <p class="mt-2">
                <span class="badge" [class.bg-success]="product.stock > 0" [class.bg-danger]="product.stock === 0">
                    {{ product.stock > 0 ? 'Disponible' : 'Fuera de stock' }}
                </span>
            </p>

            <!-- CANTIDAD -->
            <div class="qty-box mt-4">
                <label class="fw-semibold">Cantidad</label>

                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-outline-secondary" (click)="decreaseQty()"
                        [disabled]="product.quantitySelected === 1">-</button>

                    <input type="number" class="form-control qty-input" [(ngModel)]="product.quantitySelected"
                        [max]="product.stock" min="1">

                    <button class="btn btn-outline-secondary" (click)="increaseQty()"
                        [disabled]="product.quantitySelected >= product.stock">+</button>
                </div>
            </div>


            <!-- BOTÓN AGREGAR AL CARRITO -->
            <button class="btn btn-primary btn-lg mt-4" [class.btn-success]="added" (click)="addToCart()">

                <i class="mdi" [class.mdi-cart-plus]="!added" [class.mdi-check]="added"></i>
                {{ added ? 'Agregado' : 'Agregar al carrito' }}
            </button>


        </div>

    </div>
    }
</div>