<div class="cotizacion-container container">

    <!-- REGRESAR -->
    <div class="mb-3">
        <button class="btn btn-outline-secondary" type="button" (click)="goBack()">
            ← Regresar
        </button>
    </div>

    <h2 class="fw-bold mb-4">Enviar cotización</h2>

    <!-- MENSAJES -->
    @if (errorMsg) {
    <div class="alert alert-danger">{{ errorMsg }}</div>
    }

    @if (successMsg) {
    <div class="alert alert-success">{{ successMsg }}</div>
    }

    <div class="row g-4">

        <!-- FORMULARIO -->
        <div class="col-lg-7">

            <div class="card shadow-sm p-4">

                <h5 class="fw-semibold mb-3">Información del cliente</h5>

                <form [formGroup]="quoteForm">

                    <!-- Nombre -->
                    <label class="form-label fw-semibold">Nombre completo *</label>
                    <input type="text" class="form-control mb-2" formControlName="nombre">

                    @if (quoteForm.get('nombre')?.touched && quoteForm.get('nombre')?.invalid) {
                    <small class="text-danger">
                        El nombre debe tener mínimo 3 caracteres.
                    </small>
                    }

                    <!-- Correo -->
                    <label class="form-label fw-semibold mt-3">Correo electrónico *</label>
                    <input type="email" class="form-control mb-2" formControlName="correo">

                    @if (quoteForm.get('correo')?.touched && quoteForm.get('correo')?.invalid) {
                    <small class="text-danger">
                        Ingresa un correo válido.
                    </small>
                    }

                    <!-- WhatsApp -->
                    <label class="form-label fw-semibold mt-3">
                        Número de WhatsApp (opcional)
                    </label>
                    <input type="text" class="form-control mb-2" formControlName="whatsapp">

                    @if (quoteForm.get('whatsapp')?.touched && quoteForm.get('whatsapp')?.invalid) {
                    <small class="text-danger">
                        El número no es válido.
                    </small>
                    }

                    <!-- Mensaje -->
                    <label class="form-label fw-semibold mt-3">Mensaje *</label>
                    <textarea class="form-control mb-2" rows="4" formControlName="mensaje"></textarea>

                    @if (quoteForm.get('mensaje')?.touched && quoteForm.get('mensaje')?.invalid) {
                    <small class="text-danger">
                        El mensaje debe tener mínimo 5 caracteres.
                    </small>
                    }

                    <button type="button" class="btn btn-primary btn-lg mt-3 w-100"
                        [disabled]="quoteForm.invalid || cart.length === 0" (click)="onSend()">
                        Enviar cotización
                    </button>

                </form>

            </div>
        </div>

        <!-- RESUMEN DEL CARRITO -->
        <div class="col-lg-5">

            <div class="card shadow-sm p-4">

                <h5 class="fw-semibold mb-3">Resumen de la cotización</h5>

                @if (cart.length === 0) {
                <p class="text-muted">No hay productos en el carrito.</p>
                }

                @for (item of cart; track item.productId) {

                <div class="d-flex justify-content-between mb-2">

                    <span>
                        {{ item.quantitySelected }}x {{ item.name }}
                    </span>

                    <strong>
                        {{ getSubtotal(item) | customCurrency:'₡' }}
                    </strong>
                </div>

                @if (item.bestPromotion) {
                <small class="text-success d-block mb-2">
                    Incluye descuento de {{ item.bestPromotion.discountPercent }}%
                </small>
                }

                }

                <hr class="my-3">

                <div class="d-flex justify-content-between">
                    <strong>Total:</strong>
                    <strong class="text-primary">
                        {{ total | customCurrency:'₡' }}
                    </strong>
                </div>

            </div>
        </div>

    </div>

</div>