<div class="catalog-wrapper">

    <!-- TÍTULO -->
    <h2 class="fw-bold mb-3">Catálogo de Productos</h2>

    <!-- FILTROS -->
    <div class="filter-box card p-3 shadow-sm mb-4">

        <div class="row g-3">

            <!-- Categoría -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Categoría</label>
                <select class="form-select" [(ngModel)]="filters.categoryId">
                    <option value="0">Todas</option>
                    @for (c of categories; track c) {
                    <option [value]="c.categoryId">{{ c.name }}</option>
                    }
                </select>
            </div>

            <!-- Proveedor -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Proveedor</label>
                <select class="form-select" [(ngModel)]="filters.supplierId">
                    <option value="0">Todos</option>
                    @for (s of suppliers; track s) {
                    <option [value]="s.supplierId">{{ s.name }}</option>
                    }
                </select>
            </div>

            <!-- Precio mínimo -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Precio mínimo</label>
                <input type="number" class="form-control" [(ngModel)]="filters.minPrice">
            </div>

            <!-- Precio máximo -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Precio máximo</label>
                <input type="number" class="form-control" [(ngModel)]="filters.maxPrice">
            </div>


            <!-- Solo promociones -->
            <div class="col-md-3 d-flex align-items-end">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" [(ngModel)]="filters.isPromotion" id="promoCheck">
                    <label class="form-check-label" for="promoCheck">
                        Solo con promoción
                    </label>
                </div>
            </div>

            <!-- BOTONES -->
            <div class="col-12 d-flex justify-content-end gap-2 mt-3">
                <button class="btn btn-outline-secondary" (click)="onClearFilters()">
                    Limpiar
                </button>

                <button class="btn btn-primary" (click)="onFilter()">
                    Aplicar filtros
                </button>
            </div>


        </div>
    </div>

    <!-- ====================== -->
    <!-- LISTADO -->
    <!-- ====================== -->
    <div class="row g-4">

        @if (filteredProducts.length === 0) {
        <div class="col-12 text-center text-muted">
            <p class="mt-4">No hay productos que coincidan con los filtros.</p>
        </div>
        }

        @for (p of filteredProducts; track p.productId) {

        <div class="col-md-4 col-lg-3" (click)="onOpenProduct(p)">
            <div class="product-card card shadow-sm">

                <img [src]="p.mainImageUrl" class="card-img-top product-img" />

                <div class="card-body">

                    <div class="fw-semibold font-18">{{ p.name | truncate : 20 :true}}</div>

                    @if (!p.bestPromotion) {
                    <p class="mb-1">
                        <strong>{{ p.price | customCurrency:'₡' }}</strong>
                    </p>
                    }@else{
                        <p class="mb-1">
                            <strong class="text-success">{{ getFinalPrice(p) | customCurrency:'₡' }}</strong>
                        </p>
                    }


                    <!-- Categoría -->
                    <p class="text-muted small mb-1">
                        Categoría: {{ categoryName(p.categoryId) | truncate : 12 :true }}
                    </p>

                    <!-- Proveedor -->
                    <p class="text-muted small mb-1">
                        Proveedor: {{ supplierName(p.supplierId) | truncate : 12 :true }}
                    </p>

                    <!-- Estado de stock -->
                    <span class="badge" [class.bg-success]="p.stock > 0" [class.bg-danger]="p.stock === 0">
                        {{ p.stock > 0 ? 'Disponible' : 'Sin stock' }}
                    </span>

                    <!-- Promoción -->
                    @if (p.bestPromotion) {
                    <div class="mt-2">
                        <span class="badge bg-warning text-dark">
                            -{{ p.bestPromotion.discountPercent }}% hasta {{ p.bestPromotion.endDate | date }}
                        </span>
                    </div>
                    }

                </div>
            </div>
        </div>
        }

    </div>

</div>