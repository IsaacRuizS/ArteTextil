<div class="hr-wrapper p-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Ajustes de Planilla</h2>
        <button class="btn btn-primary" (click)="openCreateModal()">
            <i class="mdi mdi-plus-circle me-1"></i>Nuevo Ajuste
        </button>
    </div>

    <!-- FILTER -->
    <div class="mb-4">
        <input type="text" class="form-control" placeholder="Buscar por usuario o tipo..."
            (input)="onSearch($event)">
    </div>

    <!-- LIST -->
    <div class="card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Usuario</th>
                        <th>Monto</th>
                        <th>Tipo</th>
                        <th>Razón</th>
                        <th class="text-end pe-4">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let a of adjustments">
                        <td class="ps-4 fw-semibold">{{ a.userId }}</td>
                        <td>₡ {{ a.amount }}</td>
                        <td>{{ a.type }}</td>
                        <td>{{ a.reason || '-' }}</td>
                        <td class="text-end pe-4">
                            <button class="btn btn-sm btn-light text-danger"
                                (click)="openDeleteModal(a)">
                                <i class="mdi mdi-delete"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- FORM MODAL -->
@if (showFormModal) {
<div class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Nuevo Ajuste</h5>
                <button type="button" class="btn-close" (click)="showFormModal = false"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="adjustmentForm">
                    <div class="mb-3">
                        <label class="form-label">Usuario</label>
                        <input type="number" class="form-control" formControlName="userId">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Monto</label>
                        <input type="number" class="form-control" formControlName="amount">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" formControlName="type">
                            <option value="Extra">Extra</option>
                            <option value="Rebajo">Rebajo</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Razón</label>
                        <textarea class="form-control" formControlName="reason"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button class="btn btn-light" (click)="showFormModal = false">Cancelar</button>
                <button class="btn btn-primary" (click)="saveAdjustment()">Guardar</button>
            </div>
        </div>
    </div>
</div>
}

<!-- DELETE MODAL -->
@if (showDeleteModal) {
<div class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content text-center p-3">
            <div class="modal-body">
                <div class="mb-3 text-danger display-4"><i class="mdi mdi-alert-circle-outline"></i></div>
                <h5 class="mb-2 fw-bold">¿Eliminar ajuste?</h5>
                <p class="text-muted small">Este ajuste ya no se aplicará en planilla.</p>
                <div class="d-flex justify-content-center gap-2 mt-4">
                    <button class="btn btn-light" (click)="showDeleteModal = false">Cancelar</button>
                    <button class="btn btn-danger px-4" (click)="confirmDelete()">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
</div>
}