<div class="roles-wrapper p-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Gestión de Roles</h2>
        <button class="btn btn-primary" (click)="openCreateModal()">
            <i class="mdi mdi-plus-circle me-1"></i>Nuevo Rol
        </button>
    </div>

    <!-- FILTER -->
    <div class="mb-4">
        <input
            type="text"
            class="form-control"
            placeholder="Buscar por nombre de rol..."
            (input)="onSearch($event)"
        >
    </div>

    <!-- LIST -->
    <div class="card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <!-- <th>Id</th> -->
                        <th>Rol</th>
                        <th>Descripción</th>
                        <th>Estado</th>
                        <th class="text-end pe-4">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    <tr *ngFor="let role of roles">
                        <!-- <td class="ps-4">{{ role.roleId }}</td> -->

                        <td class="fw-semibold">{{ role.name }}</td>

                        <td class="text-muted">{{ role.description }}</td>

                        <td>
                            <span
                                class="badge rounded-pill"
                                [class.bg-success-subtle]="role.isActive"
                                [class.text-success]="role.isActive"
                                [class.bg-secondary-subtle]="!role.isActive"
                                [class.text-secondary]="!role.isActive"
                            >
                                {{ role.isActive ? 'Activo' : 'Inactivo' }}
                            </span>
                        </td>

                        <td class="text-end pe-4">
                            <button class="btn btn-sm btn-light text-primary me-2" (click)="openEditModal(role)">
                                <i class="mdi mdi-pencil"></i>
                            </button>
                            @if(role.isActive) {
                            <button class="btn btn-sm btn-light text-danger" (click)="openDeleteModal(role)">
                                <i class="mdi mdi-delete"></i>
                            </button>
                            }
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- FORM MODAL ROLES -->
@if (showFormModal) {
<div class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">
                    {{ isEditing ? 'Editar Rol' : 'Nuevo Rol' }}
                </h5>
                <button type="button" class="btn-close" (click)="showFormModal = false"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">
                <form [formGroup]="rolForm">

                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">
                            Nombre del Rol
                        </label>
                        <input
                            type="text"
                            class="form-control"
                            formControlName="name"
                            [class.is-invalid]="rolForm.get('name')?.invalid && rolForm.get('name')?.touched">
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">
                            Descripción
                        </label>
                        <textarea
                            rows="3"
                            class="form-control"
                            formControlName="description">
                        </textarea>
                    </div>

                </form>
            </div>

            <!-- FOOTER -->
            <div class="modal-footer border-0 pt-0">
                <button
                    type="button"
                    class="btn btn-light"
                    (click)="showFormModal = false">
                    Cancelar
                </button>
                <button
                    type="button"
                    class="btn btn-primary px-4"
                    [disabled]="rolForm.invalid"
                    (click)="saveRol()">
                    Guardar
                </button>
            </div>

        </div>
    </div>
</div>
}

<!-- DELETE MODAL ROL -->
@if (showDeleteModal) {
<div class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content text-center p-3">

            <div class="modal-body">
                <div class="mb-3 text-danger display-4">
                    <i class="mdi mdi-alert-circle-outline"></i>
                </div>

                <h5 class="mb-2 fw-bold">¿Desactivar rol?</h5>

                <p class="text-muted small">
                    El rol quedará inactivo
                    y no podrá asignarse a nuevos usuarios.
                </p>

                <div class="d-flex justify-content-center gap-2 mt-4">
                    <button
                        type="button"
                        class="btn btn-light"
                        (click)="showDeleteModal = false">
                        Cancelar
                    </button>

                    <button
                        type="button"
                        class="btn btn-danger px-4"
                        (click)="confirmDelete()">
                        Sí, desactivar
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>
}