<div class="promotions-wrapper">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">Promociones</h2>

        <button class="btn btn-primary" (click)="openCreateModal()">
            Crear promoción <i class="mdi mdi-plus"></i>
        </button>
    </div>

    <p class="text-muted">Administración completa de promociones.</p>

    <!-- TABLA PRINCIPAL -->
    <div class="table-responsive card shadow-sm p-3">

        <table class="table align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Promoción</th>
                    <th>Producto</th>
                    <th>Descuento</th>
                    <th>Vigencia</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>

            <tbody>
                @for (p of promotions; track p.id) {
                <tr>

                    <td>{{ p.name }}</td>
                    <td>{{ getProductName(p.productId) }}</td>
                    <td>{{ p.percent }}%</td>
                    <td>{{ p.start }} → {{ p.end }}</td>

                    <td>
                        <span class="badge state cursor-pointer" [class.bg-success]="p.status === 'Activa'"
                            [class.bg-secondary]="p.status === 'Inactiva'" [class.bg-warning]="p.status === 'Vencida'" (click)="onChangeStatus(p)">
                            {{ p.status }}
                        </span>
                    </td>

                    <td class="text-end">

                        <button class="btn btn-primary btn-sm me-1" (click)="openEditModal(p)">
                            Editar
                        </button>

                        <button class="btn btn-danger btn-sm" (click)="openDeleteModal(p)">
                            Eliminar
                        </button>

                    </td>

                </tr>
                }
            </tbody>

        </table>

    </div>

    <!-- Modales -->
    @if (showFormModal) {
    <app-promotion-form-modal [promotion]="editingPromotion" [products]="products"
        (saveCreate)="saveCreatedPromotion($event)" (saveUpdate)="saveUpdatedPromotion($event)"
        (close)="showFormModal = false">
    </app-promotion-form-modal>
    }
    
    @if (showDeleteModal) {
    <app-promotion-delete-modal [promotion]="deletePromotion" (confirm)="deletePromotionLogic()"
        (close)="showDeleteModal = false">
    </app-promotion-delete-modal>
    }

</div>