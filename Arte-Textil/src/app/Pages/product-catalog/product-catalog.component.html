<div class="catalog-container">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">Catálogo de Productos</h2>

        <button class="btn btn-primary fab" (click)="openCreateModal()">
            Agregar <i class="mdi mdi-plus"></i>
        </button>
    </div>

    <p class="text-muted mb-4">
        Mostrando productos activos configurados para el catálogo.
    </p>

    <!-- FILTROS -->
    <div class="card p-3 mb-4 shadow-sm filter-box">

        <div class="row g-3">

            <!-- Precio mínimo -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Precio mínimo</label>
                <input type="number" class="form-control" [(ngModel)]="filters.minPrice">
            </div>

            <!-- Precio máximo -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Precio máximo</label>
                <input type="number" class="form-control" [(ngModel)]="filters.maxPrice">
            </div>

            <!-- Fecha creación desde -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Fecha desde</label>
                <input type="date" class="form-control" [(ngModel)]="filters.dateFrom">
            </div>

            <!-- Fecha creación hasta -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Fecha hasta</label>
                <input type="date" class="form-control" [(ngModel)]="filters.dateTo">
            </div>

            <!-- Categoría -->
            <div class="col-md-3">
                <label class="form-label fw-semibold">Categoría</label>
                <select class="form-select" [(ngModel)]="filters.category">
                    <option value="">Todas</option>
                    @for (c of categories; track c) {
                    <option [value]="c">{{ c }}</option>
                    }
                </select>
            </div>

            <!-- BOTÓN LIMPIAR -->
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-secondary w-100" (click)="resetFilters()">
                    Limpiar filtros
                </button>
            </div>

        </div>
    </div>


    <div class="row g-4">

        @for (p of activeProducts; track p.id) {
        <div class="col-md-4 col-lg-3">

            <div class="product-card card shadow-sm" (click)="openEditModal(p)">

                <img [src]="p.image" class="card-img-top product-img">

                <div class="card-body">

                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title">{{ p.name }}</h5>

                        <span class="badge state-badge" [class.bg-success]="p.status === 'Activo'"
                            [class.bg-secondary]="p.status === 'Inactivo'" (click)="toggleStatus(p, $event)">
                            {{ p.status }}
                        </span>

                    </div>

                    <div class="card-text mb-1">
                        <strong>{{ p.price | customCurrency:'₡' }}</strong>
                    </div>

                    <div class="text-muted small mb-1">
                        Categoría: {{ p.category }}
                    </div>

                    <div class="text-muted small mb-1">
                        Materiales: {{ p.materials.join(', ') }}
                    </div>
                </div>


            </div>
        </div>
        }

    </div>
    @if (showCreateModal) {
    <app-product-form-modal [categories]="categories" [materials]="materials" (close)="showCreateModal = false">
    </app-product-form-modal>
    }

    @if (showEditModal) {
    <app-product-form-modal [product]="editProduct" [categories]="categories" [materials]="materials"
        (close)="showEditModal = false">
    </app-product-form-modal>
    }